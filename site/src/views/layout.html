<!doctype html>
<html lang="en" ng-app="app">
<head>
  <meta charset="utf-8" />
  <title></title>
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.9/angular-material.min.css" />
  <link rel="stylesheet" href="/assets/app.css">
</head>
<body ng-controller="pageCtrl" ng-cloak>
  <div layout="column" layout-align="center center" layout-padding>
    <div layout="row" layout-fill layout-align="center center" id="search">

      <form
        layout="row"
        flex="100"
        flex-gt-sm="50"
        name="searchForm"
        ng-model="searchForm"
        ng-submit="search()"
      >

        <md-input-container flex="80">
          <label>Product code</label>

          <input
            id="query-field"
            ng-model="query"
            ng-disabled="searchInProgress"
            name="number"
            placeholder="5013705221729"
            required
          >

          <div ng-messages="searchForm.query.$error">
            <!-- <div ng-message="required">The field is required!</div> -->
          </div>
        </md-input-container>

        <div flex></div>

        <section layout="row" layout-align="center center">
          <md-button
            type="submit"
            class="md-raised"
            ng-hide="searchInProgress"
            ng-disabled="!searchForm.$valid"
          >Search</md-button>

          <md-progress-circular ng-show="searchInProgress" md-mode="indeterminate"></md-progress-circular>
        </section>

      </form>
    </div>

    <div id="searchIntermediateResults" layout="column" layout-align="center center" ng-show="searchInProgress || searchShowIntermediateResults">
      <b class="text-center">{{ searchIntermediateTitle }}</b>

      <md-chips layout-align="center center">
        <md-chip ng-repeat="result in searchIntermediateResults">
          <md-tooltip>{{result.title}}</md-tooltip>

          <b>{{result['source-name']}}</b>

          <span ng-show="result.price">{{result.price}}</span>
          <span ng-show="!result.price">nothing</span>
        </md-chip>
      </md-chips>
    </div>

    <div layout="column" layout-fill layout-align="center center">
      <div ng-show="refreshingTheResults">
        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
      </div>

      <div ng-show="!results.length && !refreshingTheResults">
        <b>There're no previous search results!</b>
      </div>

      <div id="results" ng-hide="!results.length">

        <table border="0">
          <thead>
            <tr>
              <th>Amazon</th>
              <th>eBay (lowest)</th>
              <th>eBay (lowest &amp; sold)</th>
              <th>MusicMagpie</th>
              <th>Zapper</th>
              <th>Ziffit</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat-start="result in results | orderBy:'-updated_date'"
              class="query"
              ng-class-odd="'odd'" ng-class-even="'even'"
            >
              <td class="text-left" colspan="7">
                <b>{{ result.query }}</b>
                -
                <span class="title">{{ result.title }}</span>
                -
                <span class="date">
                  {{ result.updated_date | date:'dd/mm/yy HH:mm:ss' }}
                </span>
              </td>
            </tr>
            <tr
              class="prices"
              ng-class-odd="'odd'" ng-class-even="'even'"
              ng-repeat-end
            >
              <td width="16%">{{ result['price-amazon'] }}</td>
              <td width="16%">{{ result['price-ebaylowest'] }}</td>
              <td width="16%">{{ result['price-ebaylowestsold'] }}</td>
              <td width="16%">{{ result['price-musicmagpie'] }}</td>
              <td width="16%">{{ result['price-zapper'] }}</td>
              <td>{{ result['price-ziffit'] }}</td>
            </tr>

          </tbody>
        </table>

        <br/>

        <md-button class="md-warn md-warn-lg md-raised" ng-click="deleteAll()">Delete all</md-button>

      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-animate.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-aria.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-messages.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.1/angular-resource.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.0.9/angular-material.min.js"></script>
  <script src="/assets/app.js"></script>
</body>
</html>
